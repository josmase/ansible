- name: Server base software and shell configuration
  hosts: all_servers
  tags:
    - general
    - shell
  roles:
    - role: gantsign.antigen
      users:
        - username: "{{ ansible_user }}"
          antigen_libraries:
            - name: oh-my-zsh
          antigen_theme:
            name: robbyrussell
          antigen_bundles:
            - name: git
            - name: zsh-syntax-highlighting
              url: zsh-users/zsh-syntax-highlighting
    - role: core/base_setup

- name: Docker environment and container configuration
  hosts: docker_hosts
  become: true
  tags:
    - docker
    - containers
  vars_files:
    - ./vars/docker.yml
  roles:
    - container/docker_setup
    - role: core/usb_module_setup
      vars:
        usb_module_enabled: true
    - role: container/docker_template_setup
      when: docker_containers_enabled | default(false) | bool
      tags:
        - containers
        - services

- name: Kubernetes storage configuration
  hosts: k3s_nodes
  become: true
  tags:
    - kubernetes
    - storage
  roles:
    - platform/kubernetes

- name: Development environment configuration
  hosts: development_infrastructure
  become: true
  tags:
    - developer
  roles:
    - role: workstation/developer_setup

- name: Gaming workstation configuration
  hosts: gaming_workstations
  become: true
  tags:
    - gaming
  roles:
    - role: workstation/steam_xorg_session

- name: 3D printing and modeling workstation setup
  hosts: 3d_printing_workstations
  become: true
  tags:
    - 3d-printing
    - modeling
  vars:
    orcaslicer_operation: install
  roles:
    - role: workstation/3d_printing_setup

- name: Ollama server setup
  hosts: ubuntu-ms-7977.localdomain
  become: true
  tags:
    - ollama
    - ai
    - homeassistant
  roles:
    - role: services/ollama_server

- name: Wyoming voice services setup
  hosts: ubuntu-ms-7977.localdomain
  become: true
  tags:
    - wyoming
    - whisper
    - piper
    - stt
    - tts
    - homeassistant
  roles:
    - role: services/wyoming_whisper

- name: Network storage configuration
  hosts: nfs_clients
  become: true
  tags:
    - storage
    - nfs
  vars:
    nfs_mount_point: "{{ system.storage_dir }}"
    nfs_mount_src: "storage.local.hejsan.xyz:/"
  roles:
    - storage/nfs_client_setup