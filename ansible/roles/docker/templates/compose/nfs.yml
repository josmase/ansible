version: "3.7"
services:
  nfs:
    image: erichough/nfs-server
    container_name: nfs
    cap_add:
      - SYS_ADMIN
      - SYS_MODULE
    environment:
      - PUID={{ main_gid }}
      - GUID={{ main_uid }}
      - TZ={{ timezone }}
      - NFS_DISABLE_VERSION_3=true
      - NFS_EXPORT_0={{ nfs_share }} *(rw,no_subtree_check,all_squash,anonuid=1001,anongid=1001,fsid=0)
    volumes:
      - "{{ storage_dir }}:{{ nfs_share }}"
      - "/lib/modules:/lib/modules:ro"
    ports:
      - 2049:2049
    security_opt:
      - apparmor=erichough-nfs #https://github.com/ehough/docker-nfs-server/issues/5 sudo systemctl disable apparmor
    restart: always